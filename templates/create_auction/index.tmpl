{{ define "create_auction/index.tmpl" }}
<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="/css/materialize.min.css"
      media="screen,projection"
    />
    <link type="text/css" rel="stylesheet" href="/css/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create a New Auction</title>
  </head>

  <body>
    {{ template "common/navbar.tmpl" }}

    <!-- create auction page -->
    <main class="container">
      <div class="divider"></div>
      <br />
      <section id="section-post">
        <!-- create auction form -->
        {{ template "create_auction/form.tmpl" . }}
      </section>
    </main>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <script type="text/javascript">
      function uploadPics() {
        console.log("here");
        var file_data = $("#file").prop("files")[0];
        var form_data = new FormData();
        form_data.append("file", file_data);
        $.ajax({
          url: "/upload", // point to server-side controller method
          dataType: "text", // what to expect back from the server
          cache: false,
          contentType: false,
          processData: false,
          data: form_data,
          type: "post",
          success: function(response) {
            $("#msg").html(response); // display success response from the server
          },
          error: function(response) {
            $("#msg").html(response); // display error response from the server
          }
        });
        console.log(file_data);
      }
      function login() {
        var user_id = $("#login-input-username").val();
        var password = $("#login-input-password").val();
        $.ajax({
          url: `/login`,
          method: "POST",
          success: function(result) {
            M.toast({
              html: "Successfully logged in"
            });
            setTimeout(function() {
              location.reload();
            }, 500);
          },
          error: function(jqXHR, exception) {
            M.toast({
              html: JSON.parse(jqXHR.responseText)["message"]
            });
          },
          data: {
            username: user_id,
            password: password
          }
        });
      }

      function signUp() {
        var user_id = $("#signup-input-username").val();
        var pwd = $("#signup-input-password").val();
        $.ajax({
          url: `/users`,
          method: "POST",
          datatype: "json",
          contentType: "application/json",
          success: function(result) {
            M.toast({
              html: "Successfully signed up"
            });
            setTimeout(function() {
              location.reload();
            }, 500);
          },
          error: function(jqXHR, exception) {
            M.toast({
              html: jqXHR.responseText
            });
          },
          data: JSON.stringify({
            user_id: user_id,
            pwd: pwd
          })
        });
      }

      $(document).ready(function() {
        $(".modal").modal();
        updateTimer();
        updateBids();
        end_timer = setInterval(updateTimer, 1000);
        bid_timer = setInterval(updateBids, 10000);
      });
    </script>
  </body>
</html>
{{ end }}
