{{ define "auction/index.tmpl" }}
<!DOCTYPE html>
<html>

<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/css/style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ .auction.Title }}</title>
</head>

<body>
  <!-- auction details page -->
  <main class="container">
    <section>
      <!-- auction details -->
      {{ template "auction/details.tmpl" . }}
    </section>

    <section>
      <!-- bids -->
      {{ template "auction/bids.tmpl" . }}
    </section>

    <section>
      <!-- post bid -->
      {{ template "auction/post.tmpl" . }}
    </section>
  </main>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/js/materialize.min.js"></script>
  <script type="text/javascript">
    var debug = {{ . }};
    var end_time = new Date({{ .auction.EndTime }});
    updateTimer();
    var timer = setInterval(updateTimer, 1000);

    function updateTimer() {
      var now = new Date();
      var time_remain = end_time - now;
      setEndTime(time_remain);
    }

    function setEndTime(t) {
      t = Math.floor(t / 1000);
      var s = t % 60;
      t = Math.floor(t / 60);
      var m = t % 60;
      t = Math.floor(t / 60);
      var h = t;
      $("#end-timer").html(`${h}h ${m}m ${s}s`);
    }

    function submitBid() {
      var price = $('#input-price').val();
      var auction_id = 0;
      var user_id = 0;
      $.ajax({
        url: `/auctions/${auction_id}/users/${user_id}/bids`,
        method: 'POST',
        success: function (result) {
          M.toast({
            html: result
          });
        },
        data: {
          price: price
        }
      });
    }

    function signUp() {
      var user_id = $('#input-username').val();
      $.ajax({
        url: `/users`,
        method: 'POST',
        success: function (result) {
          M.toast({
            html: result
          });
        },
        data: {
          user_id: user_id
        }
      });
    }
    $(document).ready(function(){
      $('.modal').modal();
    });
  </script>
</body>

</html>
{{ end }}
